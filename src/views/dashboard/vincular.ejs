<%- include('../layouts/header', {title: 'vincular-title' }); %>

    <%- include('../layouts/sidebar'); %>

        <div class="main-content">

            <%- include('../layouts/navbar', { title: 'Vincular dispositivo' ,
                subtitle: 'Complete el formulario para crear nuevo vinculo' }); %>

                <div class="main-content__body">
                    <form class="vincular-form" id="vincularForm">
                        <h2>Completar formulario...</h2>

                        <div class="vincular-form__div">
                            <label>ID</label>
                            <input type="text" name="id" disabled placeholder="Se asigna automáticamente">
                        </div>

                        <div class="vincular-form__div">
                            <label for="petName">Nombre de la mascota</label>
                            <input type="text" name="petName" required>
                        </div>

                        <div class="vincular-form__div">
                            <label for="frequency">Frecuencia</label>
                            <input type="number" name="frequency" value="5" min="1">
                        </div>

                        <div class="vincular-form__div">
                            <label for="lowBat">Umbral batería (%)</label>
                            <input type="number" name="lowBat" value="15" min="1" max="100">
                        </div>

                        <button type="submit" class="confirm-btn">Crear tracker</button>
                    </form>

                </div>

        </div>

        <style>
            .main-content__body {
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                width: 100%;
                flex: 1;
                padding: .5rem 0rem 0rem;
                background-color: rgba(170, 170, 170, 0.2);
            }

            .vincular-form {
                display: flex;
                flex-direction: column;
                width: 80%;
                flex: .95;
                background-color: white;
                color: #691c32;
                box-shadow: 1px 1px 4px rgba(0, 0, 0, 0.2);
                padding: 1rem;
                border-radius: 5px;
            }

            .vincular-form h2 {
                font-size: 1.5rem;
                padding: .5rem 0rem .5rem;
                margin-bottom: .5rem;
                width: 100%;
                border-bottom: 2px solid #691c32;
            }

            .vincular-form__div {
                padding: .5rem 0rem;
                margin: .25rem 1rem;
                display: flex;
                flex-direction: column;
                width: 50%;
                border-bottom: 1px solid #691c32;
            }

            .vincular-form__div label {
                font-size: 1rem;
                font-weight: 400;
                margin: .15rem 0rem;
            }

            .vincular-form__div input {
                outline: none;
                border: 1px solid #ddd;
                padding: .25rem .75rem;
                box-shadow: 1px 1px 4px rgba(0, 0, 0, 0.2);
                border-radius: 25px;
                width: 80%;
            }

            .confirm-btn {
                width: 50%;
                max-height: 3rem;

                margin: 1rem 25% 0;
                padding: .5rem 2rem;

                font-weight: 400;

                background-color: #691c32;
                color: white;

                border: none;
                border-radius: 15px;

                cursor: pointer;

                transition: all 0.25s ease-in-out;
            }

            .confirm-btn:hover {
                background-color: #451321;
            }
        </style>
        
        <script>
            const vincularForm = document.getElementById("vincularForm");

            vincularForm.addEventListener("submit", async (event) => {
                event.preventDefault();

                const payload = {
                    petName: vincularForm.petName.value,
                    frequency: vincularForm.frequency.value,
                    lowBat: vincularForm.lowBat.value
                };

                try {
                    const response = await fetch("/api/trackers", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(payload)
                    });

                    const result = await response.json();

                    if (response.ok) {
                        alert("Dispositivo creado correctamente");

                    } else {
                        alert("Error: " + result.error);
                    }
                } catch (error) {
                    console.log("Error al crear dispositivo", error);
                    alert("Error al crear dispositivo");
                }
            });


        </script>

        <%- include('../layouts/footer'); %>